<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GlobalTradeHub - Trading Strategy Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
      height: 100vh;
    }

    /* Animated Background */
    .animated-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    /* Gradient Orbs */
    .gradient-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(40px);
      animation: pulse 4s ease-in-out infinite;
    }

    .orb-1 {
      width: 200px;
      height: 200px;
      background: rgba(59, 130, 246, 0.15);
      top: 20%;
      left: 20%;
    }

    .orb-2 {
      width: 160px;
      height: 160px;
      background: rgba(147, 51, 234, 0.15);
      top: 60%;
      right: 20%;
      animation-delay: 2s;
    }

    .orb-3 {
      width: 120px;
      height: 120px;
      background: rgba(16, 185, 129, 0.15);
      top: 40%;
      left: 70%;
      animation-delay: 4s;
    }

    /* Floating Icons */
    .floating-icons {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .floating-icon {
      position: absolute;
      font-size: 1.2rem;
      opacity: 0.1;
      animation: float 20s ease-in-out infinite;
    }

    .icon-1 { color: #f59e0b; top: 10%; left: 10%; animation-delay: 0s; }
    .icon-2 { color: #10b981; top: 20%; right: 20%; animation-delay: 2s; }
    .icon-3 { color: #ef4444; bottom: 30%; left: 15%; animation-delay: 4s; }
    .icon-4 { color: #3b82f6; top: 60%; right: 10%; animation-delay: 6s; }
    .icon-5 { color: #eab308; bottom: 20%; right: 30%; animation-delay: 8s; }
    .icon-6 { color: #8b5cf6; top: 40%; left: 5%; animation-delay: 10s; }

    /* Main Container */
    .main-container {
      position: relative;
      z-index: 10;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 10px;
    }

    /* Top Header */
    .top-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      height: 60px;
      position: relative;
    }

    .brand-section {
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .brand-section:hover {
      transform: scale(1.02);
    }

    .brand-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      border-radius: 10px;
      margin-right: 12px;
    }

    .brand-logo i {
      font-size: 1.2rem;
      color: white;
    }

    .brand-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin: 0;
    }

    .brand-subtitle {
      font-size: 0.8rem;
      color: #d1d5db;
      margin: 0;
    }

    /* Welcome Message */
    .welcome-message {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(16, 185, 129, 0.9);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      z-index: 1000;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(16, 185, 129, 0.3);
      animation: welcomeSlideIn 0.5s ease-out;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: none;
    }

    @keyframes welcomeSlideIn {
      0% { 
        opacity: 0; 
        transform: translateX(-50%) translateY(-20px); 
      }
      100% { 
        opacity: 1; 
        transform: translateX(-50%) translateY(0); 
      }
    }

    /* Market News Popup */
    .market-news-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 24px;
      max-width: 900px;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 2000;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      display: none;
    }

    .market-news-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .market-news-title {
      color: white;
      font-size: 1.3rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .market-news-close {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 6px;
      padding: 6px 10px;
      color: #ef4444;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s ease;
    }

    .market-news-close:hover {
      background: rgba(239, 68, 68, 0.3);
    }

    .market-news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
    }

    .market-news-country {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 18px;
    }

    .market-news-country-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .market-news-country-name {
      color: #60a5fa;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .market-news-item {
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 8px;
      border-left: 3px solid;
      transition: all 0.2s ease;
    }

    .market-news-item:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateX(2px);
    }

    .market-news-item.positive {
      border-left-color: #10b981;
    }

    .market-news-item.negative {
      border-left-color: #ef4444;
    }

    .market-news-item.neutral {
      border-left-color: #f59e0b;
    }

    .market-news-text {
      color: #d1d5db;
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 8px;
    }

    .market-news-link {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: #60a5fa;
      text-decoration: none;
      font-size: 0.8rem;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .market-news-link:hover {
      color: #93c5fd;
      text-decoration: underline;
    }

    .market-news-source {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-top: 4px;
    }

    .market-news-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1999;
      display: none;
    }

    .market-news-loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      color: #60a5fa;
    }

    .market-news-error {
      text-align: center;
      color: #ef4444;
      padding: 20px;
    }

    /* Email Report Section */
    .email-report-section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
    }

    .email-report-section input[type="email"] {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      color: white;
      padding: 4px 8px;
      width: 200px;
      font-size: 0.8rem;
    }

    .email-report-section input[type="email"]:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .email-report-section input[type="email"]::placeholder {
      color: #9ca3af;
      font-size: 0.8rem;
    }

    .email-btn {
      background: linear-gradient(135deg, #10b981, #059669);
      border: none;
      border-radius: 6px;
      padding: 4px 12px;
      font-size: 0.8rem;
      font-weight: 600;
      color: white;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .email-btn:hover {
      background: linear-gradient(135deg, #059669, #047857);
    }

    .email-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Email Spinner */
    .email-spinner {
      display: none;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 2px solid white;
      animation: spin 1s linear infinite;
      margin-right: 6px;
    }

    /* Email Success/Error Message - TOP RIGHT POSITIONING */
    .email-notification {
      display: none;
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      z-index: 1000;
      backdrop-filter: blur(12px);
      border: 1px solid;
      animation: slideInFromRight 0.5s ease-out;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .email-notification.success {
      background: rgba(16, 185, 129, 0.9);
      border-color: rgba(16, 185, 129, 0.3);
      color: white;
    }

    .email-notification.error {
      background: rgba(239, 68, 68, 0.9);
      border-color: rgba(239, 68, 68, 0.3);
      color: white;
    }

    @keyframes slideInFromRight {
      0% { 
        opacity: 0; 
        transform: translateX(100px); 
      }
      100% { 
        opacity: 1; 
        transform: translateX(0); 
      }
    }

    /* Action Buttons - DROPDOWN MENU */
    .action-buttons {
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .market-news-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.8rem;
      font-weight: 600;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .market-news-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .action-dropdown {
      position: relative;
      display: inline-block;
    }

    .action-dropdown-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.8rem;
      font-weight: 600;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .action-dropdown-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .action-dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 5px;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      min-width: 200px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      z-index: 1000;
    }

    .action-dropdown-content.show {
      display: block;
      animation: fadeInDown 0.3s ease-out;
    }

    @keyframes fadeInDown {
      0% { 
        opacity: 0; 
        transform: translateY(-10px); 
      }
      100% { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }

    .action-dropdown-item {
      display: block;
      padding: 10px 15px;
      color: white;
      text-decoration: none;
      font-size: 0.8rem;
      font-weight: 500;
      transition: all 0.2s ease;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .action-dropdown-item:last-child {
      border-bottom: none;
    }

    .action-dropdown-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #60a5fa;
    }

    .action-dropdown-item i {
      margin-right: 8px;
      width: 16px;
    }

    /* Logout Button */
    .logout-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.8rem;
      font-weight: 600;
      color: white;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      gap: 15px;
      min-height: 0;
    }

    /* Sidebar - COMPACT DESIGN */
    .sidebar {
      width: 300px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar h4 {
      color: white;
      font-size: 1rem;
      margin-bottom: 16px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    /* Content Area */
    .content-area {
      flex: 1;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    /* Tab Navigation */
    .tab-nav {
      display: flex;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding: 0 15px;
    }

    .tab-btn {
      background: none;
      border: none;
      color: #d1d5db;
      padding: 12px 20px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
    }

    .tab-btn.active {
      color: #60a5fa;
      border-bottom-color: #60a5fa;
    }

    .tab-btn:hover {
      color: white;
    }

    /* Tab Content */
    .tab-content {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      min-height: 0;
    }

    .tab-pane {
      display: none;
      height: 100%;
    }

    .tab-pane.active {
      display: block;
    }

    /* Form Styling - COMPACT DESIGN */
    .form-group {
      margin-bottom: 12px;
    }

    .form-label {
      color: #e5e7eb;
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .form-control, .form-select {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      color: white;
      padding: 8px 10px;
      font-size: 0.8rem;
      width: 100%;
      transition: all 0.2s ease;
    }

    .form-control:focus, .form-select:focus {
      background: rgba(255, 255, 255, 0.1);
      border-color: #3b82f6;
      box-shadow: 0 0 0 0.15rem rgba(59, 130, 246, 0.25);
      color: white;
      outline: none;
    }

    .form-control::placeholder {
      color: #9ca3af;
    }

    .form-select option {
      background: #1f2937;
      color: white;
    }

    /* Button Styling */
    .btn-primary-custom {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-weight: 600;
      font-size: 0.85rem;
      color: white;
      width: 100%;
      transition: all 0.2s ease;
    }

    .btn-primary-custom:hover {
      background: linear-gradient(135deg, #2563eb, #7c3aed);
      color: white;
      transform: translateY(-1px);
    }

    .btn-secondary-custom {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      padding: 8px 14px;
      font-weight: 600;
      font-size: 0.8rem;
      color: white;
      transition: all 0.2s ease;
    }

    .btn-secondary-custom:hover {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    /* Market Buttons - VERY COMPACT 2 ROWS */
    .market-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      padding: 4px 8px;
      font-weight: 600;
      font-size: 0.7rem;
      color: white;
      margin: 1px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 50px;
      text-align: center;
    }

    .market-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .market-btn.active {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      border-color: #3b82f6;
      color: white;
    }

    /* Toggle Buttons - COMPACT SIZE */
    .toggle-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .toggle-buttons .btn {
      flex: 1;
      padding: 8px 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    /* Market Navbar - VERY COMPACT 2 ROWS */
    #marketNavbar {
      transition: max-height 0.3s ease;
      overflow: hidden;
      max-height: 60px;
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    #marketNavbar.hidden-navbar {
      max-height: 0;
      margin-bottom: 0;
    }

    .market-row {
      display: flex;
      justify-content: space-between;
      gap: 2px;
    }

    .market-row.top-row {
      /* First row: US, UK, India - evenly distributed */
      justify-content: space-evenly;
      align-items: center;
    }

    .market-row.bottom-row {
      /* Second row: Japan, Germany, China - evenly distributed */
      justify-content: space-evenly;
      align-items: center;
    }

    /* Description Box - COMPACT */
    .description-box {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      padding: 8px;
      margin-bottom: 12px;
      color: #d1d5db;
      font-size: 0.75rem;
      display: none;
      line-height: 1.3;
    }

    /* Metrics Table */
    .metrics-container {
      height: 100%;
      overflow-y: auto;
    }

    .metrics table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      overflow: hidden;
      font-size: 0.85rem;
    }

    .metrics th,
    .metrics td {
      padding: 8px 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .metrics th {
      background: rgba(255, 255, 255, 0.1);
      color: #60a5fa;
      font-weight: 700;
      font-size: 0.8rem;
    }

    .metrics td {
      color: white;
      font-weight: 500;
    }

    /* Plot Container - COMPLETELY SEAMLESS AND BORDERLESS */
    .plot-container {
      height: 100%;
      background: transparent;
      border: none;
      border-radius: 0;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    /* REMOVE CHART TITLE WHEN CHART IS PRESENT */
    .plot-container h5 {
      display: none;
    }

    .plot-content {
      flex: 1;
      min-height: 0;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      border: none;
      background: transparent;
      position: relative;
    }

    /* Enhanced Plotly Styling - COMPLETELY SEAMLESS */
    .js-plotly-plot {
      border: none !important;
      background: transparent !important;
      margin: 0 !important;
      padding: 0 !important;
      width: 100% !important;
      height: 100% !important;
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
    }

    .plotly-graph-div {
      border: none !important;
      background: transparent !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    .js-plotly-plot .plotly .modebar {
      background: rgba(255, 255, 255, 0.1) !important;
      border-radius: 8px !important;
      backdrop-filter: blur(8px) !important;
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      top: 10px !important;
      right: 10px !important;
    }

    .js-plotly-plot .plotly .modebar-btn {
      color: rgba(255, 255, 255, 0.8) !important;
    }

    .js-plotly-plot .plotly .modebar-btn:hover {
      background: rgba(255, 255, 255, 0.2) !important;
      color: white !important;
    }

    /* Original Chat Container Styles - KEEPING EXACTLY THE SAME */
    .chat-container {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 1.5rem;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .chat-container h3 {
      color: white;
      margin-bottom: 1rem;
    }

    #chat-messages {
      height: 260px;
      overflow-y: auto;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      color: #d1d5db;
      flex: 1;
    }

    .chat-message {
      margin-bottom: 0.75rem;
      word-wrap: break-word;
      white-space: pre-wrap;
    }

    .user-message {
      font-weight: 700;
      color: #60a5fa;
      text-align: right;
    }

    .bot-reply {
      color: #d1d5db;
      text-align: left;
    }

    #chat-input {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: white;
      padding: 0.75rem 1rem;
      flex: 1;
      margin-right: 0.5rem;
    }

    #chat-input:focus {
      background: rgba(255, 255, 255, 0.1);
      border-color: #3b82f6;
      box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
      outline: none;
    }

    #chat-input::placeholder {
      color: #9ca3af;
    }

    #send-btn {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      border: none;
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    #send-btn:hover {
      background: linear-gradient(135deg, #2563eb, #7c3aed);
      transform: translateY(-1px);
    }

    /* ENHANCED CHAT STYLES - NEW ADDITIONS */
    
    /* Feature Pills in Welcome Message */
    .enhanced-welcome {
      line-height: 1.6;
    }

    .feature-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 12px 0;
    }

    .feature-pill {
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 20px;
      padding: 4px 12px;
      font-size: 0.75rem;
      color: #60a5fa;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* Quick Suggestions */
    .quick-suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 12px;
    }

    .suggestion-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 6px 12px;
      font-size: 0.75rem;
      color: #d1d5db;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .suggestion-btn:hover {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
      transform: translateY(-1px);
    }

    /* Enhanced Message Types */
    .response-header {
      font-weight: 600;
      color: #60a5fa;
      margin-bottom: 8px;
      padding-bottom: 4px;
      border-bottom: 1px solid rgba(96, 165, 250, 0.3);
    }

    .comparison-response,
    .explanation-response,
    .risk-response,
    .evaluation-response {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 12px;
      margin-top: 8px;
    }

    .risk-response {
      border-left: 3px solid #ef4444;
    }

    .explanation-response {
      border-left: 3px solid #8b5cf6;
    }

    .comparison-response {
      border-left: 3px solid #10b981;
    }

    .evaluation-response {
      border-left: 3px solid #f59e0b;
    }

    /* Typing Indicator */
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #9ca3af;
      font-style: italic;
    }

    .typing-dots {
      display: flex;
      gap: 2px;
    }

    .typing-dots .dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: #3b82f6;
      animation: typingDot 1.4s infinite;
    }

    .typing-dots .dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dots .dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typingDot {
      0%, 60%, 100% { opacity: 0.3; }
      30% { opacity: 1; }
    }

    /* Strategy Comparison Table */
    .comparison-table {
      margin-top: 12px;
    }

    .table-header {
      font-weight: 600;
      color: #60a5fa;
      margin-bottom: 8px;
    }

    .strategy-comparison-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      overflow: hidden;
      font-size: 0.8rem;
    }

    .strategy-comparison-table th,
    .strategy-comparison-table td {
      padding: 8px 10px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .strategy-comparison-table th {
      background: rgba(255, 255, 255, 0.1);
      color: #60a5fa;
      font-weight: 600;
      font-size: 0.75rem;
    }

    .strategy-comparison-table td {
      color: #d1d5db;
    }

    .strategy-name {
      font-weight: 600;
      color: white;
    }

    .metric-value {
      font-family: "Courier New", monospace;
      font-weight: 500;
    }

    .recommendation {
      font-weight: 600;
      text-align: center;
      border-radius: 4px;
      padding: 2px 6px;
    }

    .rec-buy {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
    }

    .rec-sell {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .rec-hold {
      background: rgba(245, 158, 11, 0.2);
      color: #f59e0b;
    }

    /* Performance Evaluation Table */
    .performance-evaluation {
      margin-top: 12px;
    }

    .evaluation-header {
      font-weight: 600;
      color: #f59e0b;
      margin-bottom: 12px;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .evaluation-metrics-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      overflow: hidden;
      font-size: 0.8rem;
    }

    .evaluation-metrics-table th,
    .evaluation-metrics-table td {
      padding: 8px 10px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .evaluation-metrics-table th {
      background: rgba(255, 255, 255, 0.1);
      color: #f59e0b;
      font-weight: 600;
      font-size: 0.75rem;
    }

    .evaluation-metrics-table td {
      color: #d1d5db;
    }

    /* Overall Assessment */
    .overall-assessment {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      padding: 12px;
      margin-top: 12px;
    }

    .assessment-header {
      font-weight: 600;
      color: #60a5fa;
      margin-bottom: 8px;
      font-size: 1rem;
    }

    .assessment-score {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .score-excellent { color: #10b981; }
    .score-good { color: #f59e0b; }
    .score-average { color: #f59e0b; }
    .score-poor { color: #ef4444; }

    /* Recommendations */
    .recommendations {
      margin-top: 12px;
    }

    .rec-header {
      font-weight: 600;
      color: #f59e0b;
      margin-bottom: 8px;
    }

    .rec-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .rec-list li {
      padding: 4px 0;
      color: #d1d5db;
      display: flex;
      align-items: center;
    }

    .rec-list li i {
      color: #10b981;
    }

    /* Alert Styling */
    .alert-danger {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 6px;
      color: #fca5a5;
      padding: 8px;
      font-size: 0.75rem;
      margin-bottom: 12px;
    }

    /* Spinner */
    .spinner {
      display: none;
      width: 30px;
      height: 30px;
      margin: 20px auto;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 3px solid #3b82f6;
      animation: spin 1s linear infinite;
    }

    /* Page Loading Overlay */
    .page-loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(8px);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .page-loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 4px solid #3b82f6;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    .page-loading-text {
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
    }

    /* Placeholder */
    .placeholder-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      text-align: center;
      color: #9ca3af;
    }

    .placeholder-content i {
      font-size: 3rem;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    /* Animations */
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-10px) rotate(120deg); }
      66% { transform: translateY(5px) rotate(240deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.15; transform: scale(1); }
      50% { opacity: 0.25; transform: scale(1.05); }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .sidebar {
        width: 280px;
      }
      
      .email-report-section input[type="email"] {
        width: 150px;
      }
    }

    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        height: 200px;
      }
      
      .top-header {
        flex-direction: column;
        height: auto;
        gap: 10px;
      }
      
      .email-report-section {
        flex-direction: column;
        gap: 5px;
      }
      
      .email-report-section input[type="email"] {
        width: 100%;
      }

      .feature-pills {
        flex-direction: column;
      }

      .quick-suggestions {
        flex-direction: column;
      }

      .suggestion-btn {
        width: 100%;
        text-align: center;
      }

      .strategy-comparison-table {
        font-size: 0.7rem;
      }

      .market-row {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
  <!-- Animated Background -->
  <div class="animated-background">
    <div class="gradient-orb orb-1"></div>
    <div class="gradient-orb orb-2"></div>
    <div class="gradient-orb orb-3"></div>
    
    <div class="floating-icons">
      <i class="fab fa-bitcoin floating-icon icon-1"></i>
      <i class="fas fa-chart-line floating-icon icon-2"></i>
      <i class="fas fa-trending-up floating-icon icon-3"></i>
      <i class="fas fa-dollar-sign floating-icon icon-4"></i>
      <i class="fas fa-bolt floating-icon icon-5"></i>
      <i class="fas fa-chart-bar floating-icon icon-6"></i>
    </div>
  </div>

  <!-- Page Loading Overlay -->
  <div class="page-loading-overlay" id="pageLoadingOverlay">
    <div class="page-loading-spinner"></div>
    <div class="page-loading-text">Refreshing Dashboard...</div>
  </div>

  <!-- Welcome Message -->
  <div class="welcome-message" id="welcomeMessage">
    <i class="fas fa-user-circle me-2"></i>
    <span id="welcomeText">Welcome back, John!</span>
  </div>

  <!-- Market News Overlay -->
  <div class="market-news-overlay" id="marketNewsOverlay" onclick="closeMarketNews()"></div>

  <!-- Market News Popup -->
  <div class="market-news-popup" id="marketNewsPopup">
    <div class="market-news-header">
      <div class="market-news-title">
        <i class="fas fa-globe"></i>
        Live Global Market News
      </div>
      <button class="market-news-close" onclick="closeMarketNews()">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
    <div class="market-news-grid" id="marketNewsGrid">
      <!-- Market news will be populated by JavaScript -->
    </div>
  </div>

  <!-- Email Notification - TOP RIGHT -->
  <div class="email-notification" id="emailNotification">
    <i class="fas fa-check me-2"></i>
    <span id="emailNotificationText">Email sent successfully!</span>
  </div>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Top Header -->
    <div class="top-header">
      <div class="brand-section" onclick="refreshToInitialState()">
        <div class="brand-logo">
          <i class="fas fa-chart-line"></i>
        </div>
        <div>
          <h1 class="brand-title">GlobalTradeHub</h1>
          <p class="brand-subtitle">Advanced Trading Strategy Dashboard</p>
        </div>
      </div>

      <div class="email-report-section">
        <i class="fas fa-envelope" style="color: #60a5fa;"></i>
        <input type="email" id="reportEmail" placeholder="Enter email for report" />
        <button class="email-btn" id="emailBtn" onclick="sendEmailReport()">
          <div class="email-spinner" id="emailSpinner"></div>
          <i class="fas fa-send me-1"></i>Send Report
        </button>
      </div>

      <div class="action-buttons">

        <!-- Trading Hub Dropdown -->
        <div class="action-dropdown">
          <button class="action-dropdown-btn" onclick="toggleActionDropdown()">
            <i class="fas fa-rocket"></i>
            Trading Hub
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="action-dropdown-content" id="actionDropdownContent">
            <a href="/trades" class="action-dropdown-item">
              <i class="fas fa-table"></i>View Trades
            </a>
            <a href="{{ url_for('recommend_strategy_page') }}" class="action-dropdown-item">
              <i class="fas fa-chart-line"></i>Test Other Strategies
            </a>
          </div>
        </div>

        <!-- Logout Button -->
        <a href="/" class="logout-btn">
          <i class="fas fa-sign-out-alt me-1"></i>Logout
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Sidebar -->
      <div class="sidebar">
        <h4><i class="fas fa-filter"></i>Strategy Configuration</h4>

        <!-- Toggle Buttons -->
        <div class="toggle-buttons">
          <button id="equityBtn" class="btn btn-primary-custom">
            <i class="fas fa-chart-area me-1"></i>Equity
          </button>
          <button id="cryptoBtn" class="btn btn-secondary-custom">
            <i class="fab fa-bitcoin me-1"></i>Crypto
          </button>
        </div>

        <!-- Market Dropdown - COMPACT 2 ROWS -->
        <div id="marketNavbar">
          <div class="market-row top-row">
            <button class="btn market-btn" data-market="US">US</button>
            <button class="btn market-btn" data-market="UK">UK</button>
            <button class="btn market-btn" data-market="India">India</button>
          </div>
          <div class="market-row bottom-row">
            <button class="btn market-btn" data-market="Japan">Japan</button>
            <button class="btn market-btn" data-market="Germany">Germany</button>
            <button class="btn market-btn" data-market="China">China</button>
          </div>
        </div>

        <!-- Strategy Form -->
        <form id="strategy-form" method="POST" novalidate>
          <div class="form-group">
            <label for="strategy" class="form-label">
              <i class="fas fa-brain"></i>Trading Strategy
            </label>
            <select id="strategy" name="strategy" class="form-select" required onchange="updateStrategyDescription()">
              <option value="">Choose a strategy</option>
              <option value="vwap">VWAP Confirmation</option>
              <option value="3_pos">3-Candle Positive Closes</option>
              <option value="hma_ema">RSI-MA Crossover</option>
              <option value="macd_ema">MACD Crossover</option>
              <option value="adx_dmi">ADX DMI Crossover</option>
              <option value="rsi_macd">RSI MACD Crossover</option>
              <option value="bb_adx">Bollinger ADX Volume Spike</option>
              <option value="rsi_bb">RSI Bollinger Band Squeeze</option>
              <option value="triple_ema">Triple EMA Crossover</option>
              <option value="elder_triple">Elder Triple Screen System</option>
            </select>
          </div>

          <div id="strategy-description" class="description-box"></div>

          <div class="form-group">
            <label for="stock" class="form-label">
              <i class="fas fa-chart-line"></i>Asset Symbol
            </label>
            <select id="stock" name="stock" class="form-select" required>
              <option value="" disabled selected>Select an asset</option>
            </select>
          </div>

          <div class="form-group">
            <label for="invest_cap" class="form-label">
              <i class="fas fa-dollar-sign"></i>Investment Capital
            </label>
            <input type="number" class="form-control" id="invest_cap" name="invest_cap" placeholder="e.g. 10000" required>
          </div>

          <div class="form-group">
            <label for="turnover" class="form-label">
              <i class="fas fa-exchange-alt"></i>Max Trades/Day
            </label>
            <input type="number" class="form-control" id="turnover" name="turnover" placeholder="e.g. 10" required>
          </div>

          <div class="form-group">
            <label for="min_trade_bal" class="form-label">
              <i class="fas fa-balance-scale"></i>Threshold Balance
            </label>
            <input type="number" class="form-control" id="min_trade_bal" name="min_trade_bal" placeholder="e.g. 500" required>
            <input type="hidden" id="is_crypto" name="is_crypto" value="false">
          </div>

          <div id="thresholdWarning" class="alert alert-danger" style="display: none;">
            <i class="fas fa-exclamation-triangle me-1"></i>
            Threshold Balance should be <b>less than</b> Investment Capital.
          </div>

          <button type="submit" id="submitButton" class="btn btn-primary-custom">
            <i class="fas fa-play me-1"></i>Run Strategy
          </button>

          <input type="hidden" id="riskFreeRateSymbol" name="rf_symbol" value="^IRX" />
        </form>
      </div>

      <!-- Content Area -->
      <div class="content-area">
        <!-- Tab Navigation -->
        <div class="tab-nav">
          <button class="tab-btn active" onclick="showTab('metrics')">
            <i class="fas fa-chart-bar me-1"></i>Portfolio Metrics
          </button>
          <button class="tab-btn" onclick="showTab('chart')">
            <i class="fas fa-chart-area me-1"></i>Performance Chart
          </button>
          <button class="tab-btn" onclick="showTab('chat')">
            <i class="fas fa-robot me-1"></i>AI Assistant
          </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Metrics Tab -->
          <div id="metrics-tab" class="tab-pane active">
            <div class="metrics-container">
              <div id="loading-spinner" class="spinner"></div>
              
              <div id="metrics-content">
                {% if metrics %}
                <div class="metrics">
                  <table>
                    <thead>
                      <tr>
                        <th><i class="fas fa-tag me-1"></i>Metric</th>
                        <th><i class="fas fa-calculator me-1"></i>Value</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr><td>Invested Capital</td><td>${{ "%.2f" % metrics.invested_capital }}</td></tr>
                      <tr><td>Portfolio Value </td><td id="usdValue">${{ "%.2f" % metrics.portfolio_value }}</td></tr>
                      <tr><td>Sharpe Ratio</td><td>{{ "%.2f" % metrics.sharpe_ratio }}</td></tr>
                      <tr><td>Sortino Ratio</td><td>{{ "%.2f" % metrics.sortino_ratio }}</td></tr>
                      <tr><td>Calmar Ratio</td><td>{{ "%.2f" % metrics.calmar_ratio }}</td></tr>
                      <tr><td>Standard Deviation</td><td>{{ "%.2f" % metrics.std }}</td></tr>
                      <tr><td>Mean Return</td><td>{{ "%.2f" % metrics.mean }}</td></tr>
                      <tr><td>Median Return</td><td>{{ "%.2f" % metrics.median }}</td></tr>
                      <tr><td>Win Rate (%)</td><td>{{ "%.2f" % metrics.win_rate }}%</td></tr>
                      <tr><td>Loss Rate (%)</td><td>{{ "%.2f" % metrics.loss_rate }}%</td></tr>
                      <tr><td>Max Drawdown</td><td>{{ "%.2f" % metrics.max_drawdown }}</td></tr>
                      <tr><td>CAGR</td><td>{{ "%.2f" % metrics.cagr }}</td></tr>
                    </tbody>
                  </table>
                </div>
                {% else %}
                <div class="placeholder-content">
                  <i class="fas fa-chart-bar"></i>
                  <p>Configure your strategy and run analysis to see portfolio metrics</p>
                </div>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Chart Tab -->
          <div id="chart-tab" class="tab-pane">
            <div class="plot-container">
              <div class="plot-content">
                {% if plot_div %}
                {{ plot_div | safe }}
                {% else %}
                <div class="placeholder-content">
                  <i class="fas fa-chart-area"></i>
                  <p>Run strategy analysis to see performance charts</p>
                </div>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Enhanced Chat Tab -->
          <div id="chat-tab" class="tab-pane">
            <div class="chat-container">
              <h3><i class="fas fa-robot me-2"></i>AI Trading Assistant</h3>
              <div id="chat-messages" tabindex="0" aria-atomic="false">
                <!-- Enhanced welcome message will be added by JavaScript -->
              </div>
              <div class="d-flex">
                <input type="text" id="chat-input" placeholder="Ask about strategy explanations or request performance evaluation..." aria-label="Chat input box" autocomplete="off" />
                <button id="send-btn" aria-label="Send chat message">
                  <i class="fas fa-paper-plane me-2"></i>Send
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Show welcome message on page load
    function showWelcomeMessage() {
      const welcomeMessage = document.getElementById('welcomeMessage');
      const welcomeText = document.getElementById('welcomeText');
      
      // Get current time for greeting
      const hour = new Date().getHours();
      let greeting = "Welcome back";
      if (hour < 12) greeting = "Good morning";
      else if (hour < 18) greeting = "Good afternoon";
      else greeting = "Good evening";
      
      welcomeText.textContent = `${greeting}, ${userName}!`;
      welcomeMessage.style.display = 'block';
      
      // Hide after 4 seconds
      setTimeout(() => {
        welcomeMessage.style.display = 'none';
      }, 4000);
    }

    // Market News Functions
    async function showMarketNews() {
      const popup = document.getElementById('marketNewsPopup');
      const overlay = document.getElementById('marketNewsOverlay');
      const grid = document.getElementById('marketNewsGrid');
      
      // Show loading state
      grid.innerHTML = '<div class="market-news-loading"><i class="fas fa-spinner fa-spin me-2"></i>Loading live market news...</div>';
      
      overlay.style.display = 'block';
      popup.style.display = 'block';
      
      try {
        // Fetch latest market news
        const marketNewsData = await fetchMarketNews();
        
        // Clear loading state
        grid.innerHTML = '';
        
        // Populate with market news for all countries
        Object.keys(marketNewsData).forEach(country => {
          const countryDiv = document.createElement('div');
          countryDiv.className = 'market-news-country';
          
          let countryIcon = '';
          switch(country) {
            case 'US': countryIcon = 'ðŸ‡ºðŸ‡¸'; break;
            case 'UK': countryIcon = 'ðŸ‡¬ðŸ‡§'; break;
            case 'India': countryIcon = 'ðŸ‡®ðŸ‡³'; break;
            case 'Japan': countryIcon = 'ðŸ‡¯ðŸ‡µ'; break;
            case 'Germany': countryIcon = 'ðŸ‡©ðŸ‡ª'; break;
            case 'China': countryIcon = 'ðŸ‡¨ðŸ‡³'; break;
          }
          
          countryDiv.innerHTML = `
            <div class="market-news-country-header">
              <span style="font-size: 1.2rem;">${countryIcon}</span>
              <div class="market-news-country-name">${country}</div>
            </div>
          `;
          
          marketNewsData[country].forEach(news => {
            const newsItem = document.createElement('div');
            newsItem.className = `market-news-item ${news.type}`;
            newsItem.innerHTML = `
              <div class="market-news-text">${news.text}</div>
              <a href="${news.link}" target="_blank" rel="noopener noreferrer" class="market-news-link">
                <i class="fas fa-external-link-alt"></i>
                Read Full Article
              </a>
              <div class="market-news-source">Source: ${news.source}</div>
            `;
            countryDiv.appendChild(newsItem);
          });
          
          grid.appendChild(countryDiv);
        });
        
      } catch (error) {
        console.error('Error displaying market news:', error);
        grid.innerHTML = '<div class="market-news-error"><i class="fas fa-exclamation-triangle me-2"></i>Error loading market news. Please try again later.</div>';
      }
    }

    function closeMarketNews() {
      const popup = document.getElementById('marketNewsPopup');
      const overlay = document.getElementById('marketNewsOverlay');
      
      overlay.style.display = 'none';
      popup.style.display = 'none';
    }

    // Enhanced Plotly Styling Function - DYNAMIC BAR COLORS BASED ON CUMULATIVE STOCKS
    function enhancePlotlyVisuals() {
      // Wait for Plotly charts to be rendered
      setTimeout(() => {
        const plotlyDivs = document.querySelectorAll('.js-plotly-plot');
        
        plotlyDivs.forEach(plotDiv => {
          if (!plotDiv) return;

          // Get the current plot data and layout - PRESERVE EXACT ORIGINAL DATA
          const currentData = plotDiv.data;
          const currentLayout = plotDiv.layout;
          
          if (!currentData || !currentLayout) return;

          // Enhanced layout with professional styling - KEEPING ALL ORIGINAL DATA INTACT
          const enhancedLayout = {
            ...currentLayout, // PRESERVE ALL ORIGINAL LAYOUT SETTINGS
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(15, 23, 42, 0.3)',
            font: {
              ...currentLayout.font,
              color: 'white',
              family: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif'
            },
            xaxis: {
              ...currentLayout.xaxis, // PRESERVE ALL ORIGINAL X-AXIS SETTINGS
              gridcolor: 'rgba(255, 255, 255, 0.1)',
              gridwidth: 1,
              tickfont: { color: '#d1d5db', size: 11 },
              titlefont: { color: '#e5e7eb', size: 13 },
              showline: true,
              linecolor: 'rgba(255, 255, 255, 0.2)',
              linewidth: 1,
              mirror: true,
              zeroline: false
            },
            yaxis: {
              ...currentLayout.yaxis, // PRESERVE ALL ORIGINAL Y-AXIS SETTINGS
              gridcolor: 'rgba(255, 255, 255, 0.1)',
              gridwidth: 1,
              tickfont: { color: '#d1d5db', size: 11 },
              titlefont: { color: '#e5e7eb', size: 13 },
              showline: true,
              linecolor: 'rgba(255, 255, 255, 0.2)',
              linewidth: 1,
              mirror: true,
              zeroline: false
            },
            yaxis2: currentLayout.yaxis2 ? {
              ...currentLayout.yaxis2, // PRESERVE ALL ORIGINAL Y2-AXIS SETTINGS
              gridcolor: 'rgba(255, 255, 255, 0.1)',
              gridwidth: 1,
              tickfont: { color: '#d1d5db', size: 11 },
              titlefont: { color: '#e5e7eb', size: 13 },
              showline: true,
              linecolor: 'rgba(255, 255, 255, 0.2)',
              linewidth: 1,
              mirror: true,
              zeroline: false
            } : undefined,
            legend: {
              ...currentLayout.legend, // PRESERVE ALL ORIGINAL LEGEND SETTINGS
              bgcolor: 'rgba(15, 23, 42, 0.8)',
              bordercolor: 'rgba(255, 255, 255, 0.2)',
              borderwidth: 1,
              font: { color: 'white', size: 8 }, // VERY SMALL legend font size
              x: 0.02,
              y: 0.98,
              orientation: 'v',
              itemsizing: 'constant',
              itemwidth: 30,
              tracegroupgap: 5, // Add spacing between legend items
              itemclick: 'toggleothers', // Better legend interaction
              itemdoubleclick: 'toggle'
            },
            hoverlabel: {
              bgcolor: 'rgba(15, 23, 42, 0.95)',
              bordercolor: 'rgba(59, 130, 246, 0.8)',
              font: { color: 'white', family: 'Segoe UI, sans-serif' }
            },
            margin: { l: 50, r: 20, t: 30, b: 40 } // Tighter margins for seamless fit
          };

          // Enhanced data styling with DYNAMIC BAR COLORS BASED ON CUMULATIVE STOCKS - PRESERVE ALL ORIGINAL DATA VALUES
          const enhancedData = currentData.map((trace, index) => {
            // Keep ALL original trace properties, just enhance visual styling
            const enhancedTrace = { ...trace };
            
            // Apply colors based on trace type and name
            if (trace.name && trace.name.toLowerCase().includes('portfolio')) {
              // Light blue for portfolio curve (non-contrasting)
              enhancedTrace.line = {
                ...trace.line,
                color: 'rgba(147, 197, 253, 0.8)', // Light blue
                width: trace.line?.width || 3,
                shape: 'spline',
                smoothing: 1.3
              };
            } else if (trace.type === 'bar' && trace.name && trace.name.toLowerCase().includes('cumulative')) {
              // DYNAMIC BAR COLORS FOR CUMULATIVE STOCKS - GREEN FOR INCREASING, RED FOR DECREASING
              if (trace.y && Array.isArray(trace.y)) {
                const colors = [];
                for (let i = 0; i < trace.y.length; i++) {
                  if (i === 0) {
                    // First bar - use neutral color
                    colors.push('rgba(156, 163, 175, 0.6)');
                  } else {
                    // Compare with previous value for cumulative stocks
                    const current = trace.y[i];
                    const previous = trace.y[i - 1];
                    if (current > previous) {
                      colors.push('rgba(34, 197, 94, 0.8)'); // Green for increasing
                    } else if (current < previous) {
                      colors.push('rgba(239, 68, 68, 0.8)'); // Red for decreasing
                    } else {
                      colors.push('rgba(156, 163, 175, 0.6)'); // Neutral for same
                    }
                  }
                }
                enhancedTrace.marker = {
                  ...trace.marker,
                  color: colors
                };
              }
            } else if (trace.type === 'bar') {
              // Other bars - use default colors
              if (trace.name && trace.name.toLowerCase().includes('skip')) {
                enhancedTrace.marker = {
                  ...trace.marker,
                  color: 'rgba(248, 113, 113, 0.6)' // Light red
                };
              } else {
                enhancedTrace.marker = {
                  ...trace.marker,
                  color: 'rgba(134, 239, 172, 0.6)' // Light green
                };
              }
            } else if (trace.type === 'scatter' && trace.mode && trace.mode.includes('lines')) {
              enhancedTrace.line = {
                ...trace.line, // PRESERVE ORIGINAL LINE SETTINGS
                width: trace.line?.width || 3,
                shape: 'spline',
                smoothing: 1.3
              };
            }
            
            // Enhance hover templates while preserving ALL data
            if (!enhancedTrace.hovertemplate) {
              enhancedTrace.hovertemplate = 
                '<b>%{fullData.name}</b><br>' +
                'Date: %{x}<br>' +
                'Value: %{y}<br>' +
                '<extra></extra>';
            }
            
            enhancedTrace.hoverlabel = {
              bgcolor: 'rgba(15, 23, 42, 0.9)',
              bordercolor: 'rgba(59, 130, 246, 0.8)',
              font: {
                color: 'white',
                family: 'Segoe UI, sans-serif',
                size: 12
              }
            };
            
            return enhancedTrace;
          });

          // Enhanced config
          const enhancedConfig = {
            displayModeBar: true,
            modeBarButtonsToRemove: [
              'pan2d', 'select2d', 'lasso2d', 'resetScale2d', 'autoScale2d'
            ],
            displaylogo: false,
            responsive: true,
            toImageButtonOptions: {
              format: 'png',
              filename: 'portfolio_performance',
              height: 500,
              width: 800,
              scale: 2
            }
          };

          // Update the plot with enhanced styling - PRESERVING ALL ORIGINAL DATA
          Plotly.react(plotDiv, enhancedData, enhancedLayout, enhancedConfig);

          // Style the modebar after update
          setTimeout(() => {
            const modebar = plotDiv.querySelector('.modebar');
            if (modebar) {
              modebar.style.background = 'rgba(255, 255, 255, 0.1)';
              modebar.style.borderRadius = '8px';
              modebar.style.backdropFilter = 'blur(8px)';
              modebar.style.border = '1px solid rgba(255, 255, 255, 0.2)';
            }

            const modebarBtns = plotDiv.querySelectorAll('.modebar-btn');
            modebarBtns.forEach(btn => {
              btn.style.color = 'rgba(255, 255, 255, 0.8)';
              btn.addEventListener('mouseenter', () => {
                btn.style.background = 'rgba(255, 255, 255, 0.2)';
                btn.style.color = 'white';
              });
              btn.addEventListener('mouseleave', () => {
                btn.style.background = 'transparent';
                btn.style.color = 'rgba(255, 255, 255, 0.8)';
              });
            });
          }, 100);
        });
      }, 500);
    }

    // Refresh to initial state function for GlobalTradeHub logo
    function refreshToInitialState() {
      const pageLoadingOverlay = document.getElementById('pageLoadingOverlay');
      pageLoadingOverlay.style.display = 'flex';
      
      setTimeout(() => {
        // Reset all form fields
        document.getElementById('strategy-form').reset();
        document.getElementById('strategy-description').style.display = 'none';
        
        // Reset market selection
        document.querySelectorAll('.market-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector('[data-market="US"]').classList.add('active');
        
        // Reset toggle buttons
        document.getElementById('equityBtn').classList.add('btn-primary-custom');
        document.getElementById('equityBtn').classList.remove('btn-secondary-custom');
        document.getElementById('cryptoBtn').classList.add('btn-secondary-custom');
        document.getElementById('cryptoBtn').classList.remove('btn-primary-custom');
        
        // Reset content areas to initial state
        document.getElementById('metrics-content').innerHTML = `
          <div class="placeholder-content">
            <i class="fas fa-chart-bar"></i>
            <p>Configure your strategy and run analysis to see portfolio metrics</p>
          </div>
        `;
        
        document.querySelector('#chart-tab .plot-content').innerHTML = `
          <div class="placeholder-content">
            <i class="fas fa-chart-area"></i>
            <p>Run strategy analysis to see performance charts</p>
          </div>
        `;
        
        // Reset chat
        if (window.tradingChat) {
          window.tradingChat.addEnhancedWelcomeMessage();
        }
        
        // Reset global state
        hasRunAnalysis = false;
        
        // Hide loading overlay
        pageLoadingOverlay.style.display = 'none';
        
        // Show welcome message
        showWelcomeMessage();
      }, 1500);
    }

    // Action Dropdown Toggle
    function toggleActionDropdown() {
      const dropdown = document.getElementById('actionDropdownContent');
      dropdown.classList.toggle('show');
    }

    // Close dropdown when clicking outside
    window.addEventListener('click', function(event) {
      if (!event.target.matches('.action-dropdown-btn') && !event.target.closest('.action-dropdown-btn')) {
        const dropdown = document.getElementById('actionDropdownContent');
        if (dropdown.classList.contains('show')) {
          dropdown.classList.remove('show');
        }
      }
    });

    // Tab functionality
    function showTab(tabName) {
      // Hide all tab panes
      document.querySelectorAll('.tab-pane').forEach(pane => {
        pane.classList.remove('active');
      });
      
      // Remove active class from all tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab pane
      document.getElementById(tabName + '-tab').classList.add('active');
      
      // Add active class to clicked tab button
      event.target.classList.add('active');

      // Enhance Plotly visuals when chart tab is shown
      if (tabName === 'chart') {
        enhancePlotlyVisuals();
      }
    }

    // Enhanced Email report functionality with TOP RIGHT notification
    function sendEmailReport() {
      const email = document.getElementById('reportEmail').value;
      const emailBtn = document.getElementById('emailBtn');
      const emailSpinner = document.getElementById('emailSpinner');
      const emailNotification = document.getElementById('emailNotification');
      const emailNotificationText = document.getElementById('emailNotificationText');

      if (!email) {
        showEmailNotification('Please enter an email address', 'error');
        return;
      }

      // Show spinner and disable button
      emailSpinner.style.display = 'inline-block';
      emailBtn.disabled = true;
      emailBtn.style.opacity = '0.6';

      fetch('/send_email', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: `user_email=${encodeURIComponent(email)}`
      })
      .then(response => {
        // Hide spinner and re-enable button
        emailSpinner.style.display = 'none';
        emailBtn.disabled = false;
        emailBtn.style.opacity = '1';

        if (response.ok) {
          showEmailNotification('Email sent successfully!', 'success');
        } else {
          showEmailNotification('Failed to send email', 'error');
        }
      })
      .catch(error => {
        // Hide spinner and re-enable button
        emailSpinner.style.display = 'none';
        emailBtn.disabled = false;
        emailBtn.style.opacity = '1';
        
        console.error("Error sending email:", error);
        showEmailNotification('Error sending email', 'error');
      });
    }

    // Show email notification in top right
    function showEmailNotification(message, type) {
      const emailNotification = document.getElementById('emailNotification');
      const emailNotificationText = document.getElementById('emailNotificationText');
      
      emailNotificationText.textContent = message;
      emailNotification.className = `email-notification ${type}`;
      emailNotification.style.display = 'block';
      
      // Hide notification after 4 seconds
      setTimeout(() => {
        emailNotification.style.display = 'none';
      }, 4000);
    }

    // All the existing JavaScript functionality from the original file
    const equityBtn = document.getElementById('equityBtn');
    const cryptoBtn = document.getElementById('cryptoBtn');
    const isCryptoInput = document.getElementById('is_crypto');
    const marketButtons = document.querySelectorAll('.market-btn');
    const stockSelect = document.getElementById('stock');
    const marketNavbar = document.getElementById('marketNavbar');
    const loadingSpinner = document.getElementById('loading-spinner');
    const strategyForm = document.getElementById('strategy-form');

    let currentMarket = "equity";
    let selectedRegion = "US";

    const cryptoAssets = [
      { symbol: "BTC-USD", name: "Bitcoin" },
      { symbol: "ETH-USD", name: "Ethereum" },
      { symbol: "BNB-USD", name: "Binance Coin" },
      { symbol: "XRP-USD", name: "Ripple" },
      { symbol: "ADA-USD", name: "Cardano" },
      { symbol: "SOL-USD", name: "Solana" },
      { symbol: "DOGE-USD", name: "Dogecoin" },
      { symbol: "DOT-USD", name: "Polkadot" },
      { symbol: "LTC-USD", name: "Litecoin" },
      { symbol: "AVAX-USD", name: "Avalanche" },
      { symbol: "SHIB-USD", name: "Shiba Inu" },
      { symbol: "MATIC-USD", name: "Polygon" },
      { symbol: "LINK-USD", name: "Chainlink" },
      { symbol: "ATOM-USD", name: "Cosmos" },
      { symbol: "TRX-USD", name: "TRON" }
    ];

    const marketStocks = {
      US: [
        { symbol: "AAPL", name: "Apple Inc." },
        { symbol: "MSFT", name: "Microsoft Corporation" },
        { symbol: "JPM", name: "JPMorgan Chase & Co." },
        { symbol: "V", name: "Visa Inc." },
        { symbol: "WMT", name: "Walmart Inc." },
        { symbol: "DIS", name: "The Walt Disney Company" },
        { symbol: "MCD", name: "McDonald's Corporation" },
        { symbol: "NKE", name: "Nike, Inc." },
        { symbol: "KO", name: "The Coca-Cola Company" },
        { symbol: "PG", name: "The Procter & Gamble Company" },
        { symbol: "GS", name: "The Goldman Sachs Group, Inc." },
        { symbol: "INTC", name: "Intel Corporation" },
        { symbol: "CVX", name: "Chevron Corporation" },
        { symbol: "TRV", name: "The Travelers Companies, Inc." },
        { symbol: "HD", name: "The Home Depot, Inc." },
        { symbol: "IBM", name: "International Business Machines Corporation" },
        { symbol: "BA", name: "The Boeing Company" },
        { symbol: "CAT", name: "Caterpillar Inc." },
        { symbol: "MMM", name: "3M Company" },
        { symbol: "MRK", name: "Merck & Co., Inc." },
        { symbol: "AXP", name: "American Express Company" },
        { symbol: "CSCO", name: "Cisco Systems, Inc." },
        { symbol: "JNJ", name: "Johnson & Johnson" },
        { symbol: "VZ", name: "Verizon Communications Inc." },
        { symbol: "UNH", name: "UnitedHealth Group Incorporated" },
        { symbol: "DOW", name: "Dow Inc." },
        { symbol: "XOM", name: "Exxon Mobil Corporation" },
        { symbol: "WBA", name: "Walgreens Boots Alliance, Inc." },
        { symbol: "CSX", name: "CSX Corporation" }
      ],

      UK: [
        { symbol: "HSBA.L", name: "HSBC Holdings" },
        { symbol: "BP.L", name: "BP plc" },
        { symbol: "RDSA.L", name: "Shell plc" },
        { symbol: "GSK.L", name: "GlaxoSmithKline" },
        { symbol: "AZN.L", name: "AstraZeneca" },
        { symbol: "VOD.L", name: "Vodafone Group" },
        { symbol: "BATS.L", name: "British American Tobacco" },
        { symbol: "RIO.L", name: "Rio Tinto Group" },
        { symbol: "LLOY.L", name: "Lloyds Banking Group" },
        { symbol: "SHEL.L", name: "Shell plc (Class A)" },
        { symbol: "BARC.L", name: "Barclays" },
        { symbol: "BT.A.L", name: "BT Group" },
        { symbol: "ULVR.L", name: "Unilever" },
        { symbol: "PRU.L", name: "Prudential plc" },
        { symbol: "DGE.L", name: "Diageo" },
        { symbol: "BA.L", name: "Bae Systems" },
        { symbol: "GLEN.L", name: "Glencore" },
        { symbol: "TSCO.L", name: "Tesco" },
        { symbol: "SMIN.L", name: "Smith & Nephew" },
        { symbol: "CNA.L", name: "Centrica" },
        { symbol: "IMB.L", name: "Imperial Brands" },
        { symbol: "ADM.L", name: "Admiral Group" },
        { symbol: "EVR.L", name: "Everest Group" },
        { symbol: "ANTO.L", name: "Antofagasta" },
        { symbol: "AUTO.L", name: "Auto Trader Group" },
        { symbol: "CCL.L", name: "Carnival Corporation" },
        { symbol: "III.L", name: "3i Group" },
        { symbol: "PSN.L", name: "Persimmon" },
        { symbol: "LGEN.L", name: "Legal & General" }
      ],

      India: [
        { symbol: "ADANIENT.NS", name: "Adani Enterprises" },
        { symbol: "ADANIPORTS.NS", name: "Adani Ports & SEZ" },
        { symbol: "APOLLOHOSP.NS", name: "Apollo Hospitals" },
        { symbol: "ASIANPAINT.NS", name: "Asian Paints" },
        { symbol: "AXISBANK.NS", name: "Axis Bank" },
        { symbol: "BAJAJ-AUTO.NS", name: "Bajaj Auto" },
        { symbol: "BAJFINANCE.NS", name: "Bajaj Finance" },
        { symbol: "BAJAJFINSV.NS", name: "Bajaj Finserv" },
        { symbol: "BEL.NS", name: "Bharat Electronics" },
        { symbol: "BHARTIARTL.NS", name: "Bharti Airtel" },
        { symbol: "BPCL.NS", name: "Bharat Petroleum" },
        { symbol: "BRITANNIA.NS", name: "Britannia Industries" },
        { symbol: "CIPLA.NS", name: "Cipla" },
        { symbol: "COALINDIA.NS", name: "Coal India" },
        { symbol: "DIVISLAB.NS", name: "Divi's Laboratories" },
        { symbol: "DRREDDY.NS", name: "Dr. Reddy's Laboratories" },
        { symbol: "EICHERMOT.NS", name: "Eicher Motors" },
        { symbol: "GRASIM.NS", name: "Grasim Industries" },
        { symbol: "HCLTECH.NS", name: "HCL Technologies" },
        { symbol: "HDFCBANK.NS", name: "HDFC Bank" },
        { symbol: "HDFCLIFE.NS", name: "HDFC Life Insurance" },
        { symbol: "HEROMOTOCO.NS", name: "Hero MotoCorp" },
        { symbol: "HINDALCO.NS", name: "Hindalco Industries" },
        { symbol: "HINDUNILVR.NS", name: "Hindustan Unilever" },
        { symbol: "ICICIBANK.NS", name: "ICICI Bank" },
        { symbol: "INDUSINDBK.NS", name: "IndusInd Bank" },
        { symbol: "INFY.NS", name: "Infosys" },
        { symbol: "ITC.NS", name: "ITC" },
        { symbol: "JSWSTEEL.NS", name: "JSW Steel" },
        { symbol: "KOTAKBANK.NS", name: "Kotak Mahindra Bank" },
        { symbol: "LTIM.NS", name: "LTIMindtree" },
        { symbol: "LT.NS", name: "Larsen & Toubro" },
        { symbol: "M&M.NS", name: "Mahindra & Mahindra" },
        { symbol: "MARUTI.NS", name: "Maruti Suzuki" },
        { symbol: "NESTLEIND.NS", name: "NestlÃ© India" },
        { symbol: "NTPC.NS", name: "NTPC" },
        { symbol: "ONGC.NS", name: "Oil & Natural Gas Corporation" },
        { symbol: "POWERGRID.NS", name: "Power Grid Corporation" },
        { symbol: "RELIANCE.NS", name: "Reliance Industries" },
        { symbol: "SBILIFE.NS", name: "SBI Life Insurance" },
        { symbol: "SBIN.NS", name: "State Bank of India" },
        { symbol: "SHRIRAMFIN.NS", name: "Shriram Finance" },
        { symbol: "SUNPHARMA.NS", name: "Sun Pharmaceutical" },
        { symbol: "TATACONSUM.NS", name: "Tata Consumer Products" },
        { symbol: "TATAMOTORS.NS", name: "Tata Motors" },
        { symbol: "TATASTEEL.NS", name: "Tata Steel" },
        { symbol: "TCS.NS", name: "Tata Consultancy Services" },
        { symbol: "TECHM.NS", name: "Tech Mahindra" },
        { symbol: "TITAN.NS", name: "Titan Company" },
        { symbol: "ULTRACEMCO.NS", name: "UltraTech Cement" },
        { symbol: "WIPRO.NS", name: "Wipro" }
      ],

      Japan: [
        { symbol: "7203.T", name: "Toyota Motor" },
        { symbol: "6758.T", name: "Sony Group" },
        { symbol: "9984.T", name: "SoftBank Group" },
        { symbol: "6861.T", name: "Keyence" },
        { symbol: "8306.T", name: "Mitsubishi UFJ Financial Group" },
        { symbol: "4502.T", name: "Takeda Pharmaceutical" },
        { symbol: "8035.T", name: "Tokyo Electron" },
        { symbol: "6869.T", name: "Sony Financial Holdings" },
        { symbol: "7751.T", name: "Canon" },
        { symbol: "9432.T", name: "Nippon Telegraph & Telephone" },
        { symbol: "7011.T", name: "Mitsubishi Heavy Industries" },
        { symbol: "7974.T", name: "Nintendo" },
        { symbol: "4063.T", name: "Shin-Etsu Chemical" },
        { symbol: "8766.T", name: "Tokyo Marine Holdings" },
        { symbol: "8411.T", name: "Mizuho Financial Group" },
        { symbol: "8058.T", name: "Mitsubishi Corp" },
        { symbol: "5401.T", name: "Nippon Steel" },
        { symbol: "7201.T", name: "Nissan Motor" },
        { symbol: "4519.T", name: "Chugai Pharmaceutical" },
        { symbol: "6954.T", name: "Fanuc" }
      ],

      Germany: [
        { symbol: "ADS.DE", name: "Adidas" },
        { symbol: "ALV.DE", name: "Allianz" },
        { symbol: "BAS.DE", name: "BASF" },
        { symbol: "BAYN.DE", name: "Bayer" },
        { symbol: "BEI.DE", name: "Beiersdorf" },
        { symbol: "BMW.DE", name: "BMW" },
        { symbol: "CBK.DE", name: "Commerzbank" },
        { symbol: "DAI.DE", name: "Daimler" },
        { symbol: "DPW.DE", name: "Deutsche Post" },
        { symbol: "DTE.DE", name: "Deutsche Telekom" },
        { symbol: "EOAN.DE", name: "E.ON" },
        { symbol: "FME.DE", name: "Fresenius Medical Care" },
        { symbol: "FRE.DE", name: "Fresenius" },
        { symbol: "HEI.DE", name: "HeidelbergCement" },
        { symbol: "HEN3.DE", name: "Henkel" },
        { symbol: "IFX.DE", name: "Infineon Technologies" },
        { symbol: "LIN.DE", name: "Linde" },
        { symbol: "MRK.DE", name: "Merck" },
        { symbol: "MTX.DE", name: "MTU Aero Engines" },
        { symbol: "MUV2.DE", name: "MÃ¼nchener RÃ¼ck" },
        { symbol: "RWE.DE", name: "RWE" },
        { symbol: "SAP.DE", name: "SAP" },
        { symbol: "SIE.DE", name: "Siemens" },
        { symbol: "VNA.DE", name: "Vonovia" },
        { symbol: "VOW3.DE", name: "Volkswagen" }
      ],

      China: [
        { symbol: "0700.HK", name: "Tencent Holdings" },
        { symbol: "0939.HK", name: "China Mobile" },
        { symbol: "1299.HK", name: "AIA Group" },
        { symbol: "2318.HK", name: "Ping An Insurance" },
        { symbol: "0388.HK", name: "HK Exchanges" },
        { symbol: "0005.HK", name: "HSBC Holdings" },
        { symbol: "3988.HK", name: "Bank of China" },
        { symbol: "0941.HK", name: "China Mobile" },
        { symbol: "3690.HK", name: "Meituan" },
        { symbol: "9618.HK", name: "JD.com" },
        { symbol: "9988.HK", name: "Alibaba Group" },
        { symbol: "0762.HK", name: "China Unicom" },
        { symbol: "1398.HK", name: "ICBC" },
        { symbol: "2313.HK", name: "China Resources" },
        { symbol: "2628.HK", name: "China Life Insurance" },
        { symbol: "2600.HK", name: "China Southern Airlines" },
        { symbol: "3328.HK", name: "Bank of Communications" },
        { symbol: "6823.HK", name: "China Gas Holdings" },
        { symbol: "0001.HK", name: "CK Hutchison Holdings" },
        { symbol: "1093.HK", name: "China Shenhua Energy" }
      ]
    };

    const riskFreeRateSymbols = {
      US: "^IRX",           // 13 Week Treasury Bill ^IRX
      India: "^IRX_IN",     // (You may define custom or hardcoded for India)
      Japan: "^JPNIRX",     // 3 Month Japanese T-Bill ^JPNIRX
      UK: "^FTSE",          // Substitute example, or actual short term gilt ticker
      Germany: "^DEIRX",    // Hypothetical, replace with actual symbol
      China: "^CNIRX"       // Hypothetical, replace with actual symbol
    };
    function populateStockOptions(stockList) {
      stockSelect.innerHTML = '<option value="" disabled selected>Select an asset</option>';
      stockList.forEach(stock => {
        const option = document.createElement('option');
        option.value = stock.symbol;
        option.textContent = `${stock.name} (${stock.symbol})`;
        stockSelect.appendChild(option);
      });
    }

    function updateRiskFreeRateInput() {
      const rfSymbol = riskFreeRateSymbols[selectedRegion] || "^IRX"; // default US
      // For crypto, maybe set to 0 or fixed RF as crypto usually uses USD RF or zero
      let rfValue = currentMarket === "crypto" ? "0" : rfSymbol;
      
      // Assuming you have a hidden input to send RF symbol or value to backend
      const rfInput = document.getElementById('riskFreeRateSymbol');
      if(rfInput) {
        rfInput.value = rfValue;
      }
    }

    equityBtn.addEventListener('click', () => {
      currentMarket = "equity";
      isCryptoInput.value = "false"; 
      updateRiskFreeRateInput();
      equityBtn.classList.remove('btn-secondary-custom');
      equityBtn.classList.add('btn-primary-custom');
      cryptoBtn.classList.remove('btn-primary-custom');
      cryptoBtn.classList.add('btn-secondary-custom');

      marketNavbar.classList.remove('hidden-navbar');
      populateStockOptions(marketStocks[selectedRegion] || []);
    });

    cryptoBtn.addEventListener('click', () => {
      currentMarket = "crypto";
      isCryptoInput.value = "true";
      updateRiskFreeRateInput();
      cryptoBtn.classList.remove('btn-secondary-custom');
      cryptoBtn.classList.add('btn-primary-custom');
      equityBtn.classList.remove('btn-primary-custom');
      equityBtn.classList.add('btn-secondary-custom');

      marketNavbar.classList.add('hidden-navbar');
      populateStockOptions(cryptoAssets);
    });

    marketButtons.forEach(button => {
      button.addEventListener('click', () => {
        marketButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        selectedRegion = button.getAttribute('data-market');
        updateRiskFreeRateInput();
        if (currentMarket === "equity") {
          populateStockOptions(marketStocks[selectedRegion] || []);
        }
      });
    });

    window.addEventListener('DOMContentLoaded', () => {
      marketButtons[0].classList.add('active');
      populateStockOptions(marketStocks["US"]);
      
      // Show welcome message on page load
      showWelcomeMessage();
      
      // Enhance existing Plotly charts on page load
      enhancePlotlyVisuals();
    });

    // Enhanced form submission with refresh functionality
    strategyForm.addEventListener("submit", (e) => {
      if (!e.target.checkValidity()) {
        e.preventDefault();
        alert("Please fill in all required fields.");
        return;
      }
      
      // If user has already run analysis, show loading overlay and refresh
      if (hasRunAnalysis) {
        e.preventDefault();
        const pageLoadingOverlay = document.getElementById('pageLoadingOverlay');
        pageLoadingOverlay.style.display = 'flex';
        
        // Clear all content and reset to initial state
        setTimeout(() => {
          // Reset all tabs to show placeholder content
          document.getElementById('metrics-content').innerHTML = `
            <div class="placeholder-content">
              <i class="fas fa-chart-bar"></i>
              <p>Configure your strategy and run analysis to see portfolio metrics</p>
            </div>
          `;
          
          document.querySelector('#chart-tab .plot-content').innerHTML = `
            <div class="placeholder-content">
              <i class="fas fa-chart-area"></i>
              <p>Run strategy analysis to see performance charts</p>
            </div>
          `;
          
          // Reset chat
          if (window.tradingChat) {
            window.tradingChat.addEnhancedWelcomeMessage();
          }
          
          // Hide loading overlay and submit form
          pageLoadingOverlay.style.display = 'none';
          hasRunAnalysis = false;
          strategyForm.submit();
        }, 1500);
        
        return;
      }
      
      // First time running analysis
      loadingSpinner.style.display = "block";
      strategyForm.querySelector('button[type="submit"]').disabled = true;
      hasRunAnalysis = true;
    });

    // ENHANCED CHAT FUNCTIONALITY - MODIFIED VERSION WITHOUT "WHY THIS STRATEGY"
    class EnhancedTradingChat {
      constructor() {
        this.chatMessages = document.getElementById("chat-messages")
        this.chatInput = document.getElementById("chat-input")
        this.sendBtn = document.getElementById("send-btn")
        this.selectedStrategies = JSON.parse('{{ selected_strategies | tojson | safe }}' || '[]')
        this.messageHistory = []
        this.isTyping = false
        this.currentMetrics = null // Store current strategy metrics

        this.initializeChat()
      }

      initializeChat() {
        // Keep your original event listeners
        this.sendBtn.addEventListener("click", () => this.sendMessage())
        this.chatInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") this.sendMessage()
        })

        // Add enhanced welcome message
        this.addEnhancedWelcomeMessage()
        
        // Extract current metrics from page if available
        this.extractCurrentMetrics()
      }

      extractCurrentMetrics() {
        // Extract metrics from the current page
        const metricsTable = document.querySelector('.metrics table tbody');
        if (metricsTable) {
          const rows = metricsTable.querySelectorAll('tr');
          this.currentMetrics = {};
          
          rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            if (cells.length === 2) {
              const metric = cells[0].textContent.trim();
              const value = cells[1].textContent.trim();
              this.currentMetrics[metric] = value;
            }
          });
        }
      }

      addEnhancedWelcomeMessage() {
        // Clear existing welcome and add enhanced one
        this.chatMessages.innerHTML = ""

        const welcomeDiv = document.createElement("div")
        welcomeDiv.classList.add("chat-message", "bot-reply")
        welcomeDiv.innerHTML = `
          <i class="fas fa-robot me-2"></i>
          <div class="enhanced-welcome">
            ðŸ¤– Hello! I'm your AI trading assistant. I can help you with:
            <div class="feature-pills">
              <span class="feature-pill"><i class="fas fa-chart-line"></i> Performance Analysis</span>
              <span class="feature-pill"><i class="fas fa-shield-alt"></i> Risk Assessment</span>
              <span class="feature-pill"><i class="fas fa-lightbulb"></i> Trading Insights</span>
            </div>
            <div class="quick-suggestions">
              <button class="suggestion-btn" onclick="tradingChat.quickQuery('evaluation')">ðŸ“Š Performance Evaluation</button>
              <button class="suggestion-btn" onclick="tradingChat.quickQuery('risk')">âš ï¸ Risk Analysis</button>
              <button class="suggestion-btn" onclick="tradingChat.quickQuery('insights')">ðŸ’¡ Trading Insights</button>
            </div>
          </div>
        `

        this.chatMessages.appendChild(welcomeDiv)
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight
      }

      quickQuery(type) {
        const queries = {
          evaluation: "performance evaluation",
          risk: "Analyze the risk profile of this strategy",
          insights: "What are the key insights from this strategy's performance?",
        }

        if (queries[type]) {
          this.chatInput.value = queries[type]
          this.sendMessage()
        }
      }

      detectMessageType(message) {
        const lowerMessage = message.toLowerCase();
        if (
          lowerMessage.includes("performance evaluation") ||
          lowerMessage.includes("evaluate performance") ||
          lowerMessage.includes("performance metrics")
        ) {
          return "evaluation";
        } else if (
          lowerMessage.includes("explain") ||
          lowerMessage.includes("reason")
        ) {
          return "explanation";
        } else if (
          lowerMessage.includes("risk") ||
          lowerMessage.includes("drawdown")
        ) {
          return "risk_analysis";
        }
        return "general";
      }

      appendMessage(text, isUser, messageType = "normal") {
        const messageDiv = document.createElement("div")
        messageDiv.classList.add("chat-message")
        messageDiv.classList.add(isUser ? "user-message" : "bot-reply")

        if (isUser) {
          messageDiv.innerHTML = `<i class="fas fa-user me-2"></i>${text}`
        } else {
          if (messageType === "evaluation") {
            messageDiv.innerHTML = `<i class="fas fa-chart-line me-2"></i>${this.formatEvaluationMessage(text)}`
          } else if (messageType === "explanation") {
            messageDiv.innerHTML = `<i class="fas fa-lightbulb me-2"></i>${this.formatExplanationMessage(text)}`
          } else if (messageType === "risk_analysis") {
            messageDiv.innerHTML = `<i class="fas fa-shield-alt me-2"></i>${this.formatRiskMessage(text)}`
          } else {
            messageDiv.innerHTML = `<i class="fas fa-robot me-2"></i>${text}`
          }
        }

        this.chatMessages.appendChild(messageDiv)
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight

        // Add to history
        this.messageHistory.push({
          text: text,
          isUser: isUser,
          type: messageType,
          timestamp: new Date().toISOString(),
        })
      }

      formatEvaluationMessage(text) {
        // Enhanced formatting for performance evaluation
        return `
          <div class="evaluation-response">
            <div class="response-header">
              <i class="fas fa-chart-bar me-2"></i>Performance Evaluation Analysis
            </div>
            <div class="response-content">${text}</div>
          </div>
        `
      }

      formatExplanationMessage(text) {
        // Enhanced formatting for strategy explanations
        return `
          <div class="explanation-response">
            <div class="response-header">
              <i class="fas fa-brain me-2"></i>Strategy Explanation
            </div>
            <div class="response-content">${text}</div>
          </div>
        `
      }

      formatRiskMessage(text) {
        // Enhanced formatting for risk analysis
        return `
          <div class="risk-response">
            <div class="response-header">
              <i class="fas fa-exclamation-triangle me-2"></i>Risk Assessment
            </div>
            <div class="response-content">${text}</div>
          </div>
        `
      }

      showTypingIndicator() {
        this.isTyping = true
        const loadingMsg = document.createElement("div")
        loadingMsg.classList.add("chat-message", "bot-reply")
        loadingMsg.id = "typing-indicator"
        loadingMsg.innerHTML = `
          <i class="fas fa-robot me-2"></i>
          <div class="typing-indicator">
            <span>AI is analyzing</span>
            <div class="typing-dots">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </div>
          </div>
        `

        this.chatMessages.appendChild(loadingMsg)
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight
      }

      hideTypingIndicator() {
        this.isTyping = false
        const typingIndicator = document.getElementById("typing-indicator")
        if (typingIndicator) {
          typingIndicator.remove()
        }
      }

      async sendMessage() {
        const userText = this.chatInput.value.trim()
        if (!userText || this.isTyping) return

        const messageType = this.detectMessageType(userText)
        this.appendMessage(userText, true)
        this.chatInput.value = ""
        this.showTypingIndicator()

        try {
          // Handle performance evaluation locally
          if (messageType === "evaluation") {
            this.hideTypingIndicator()
            this.handlePerformanceEvaluation()
            return
          }

          // For other messages, use the existing chat endpoint
          const response = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              message: userText,
              selected_strategies: this.selectedStrategies,
              message_type: messageType,
            }),
          })

          const data = await response.json()
          this.hideTypingIndicator()

          // Handle different response types
          if (data.type) {
            this.appendMessage(data.reply, false, data.type)

            // Handle additional data
            if (data.recommendations) {
              this.showRecommendations(data.recommendations)
            }
          } else {
            this.appendMessage(data.reply, false)
          }
        } catch (error) {
          this.hideTypingIndicator()
          this.appendMessage("Error: " + error.message, false, "error")
        }
      }

      handlePerformanceEvaluation() {
        // Extract current metrics and provide comprehensive evaluation
        this.extractCurrentMetrics()
        
        if (!this.currentMetrics) {
          this.appendMessage("âš ï¸ Please run a strategy analysis first to see performance evaluation.", false, "evaluation")
          return
        }

        // Create evaluation message
        const evaluationText = `
          <div class="performance-evaluation">
            <div class="evaluation-header">ðŸ“Š Comprehensive Performance Evaluation</div>
            <div class="evaluation-content">
              <p><strong>Strategy Performance Overview:</strong></p>
              <p>Based on your current strategy analysis, here's a comprehensive evaluation of all performance metrics:</p>
            </div>
          </div>
        `

        this.appendMessage(evaluationText, false, "evaluation")
        
        // Render performance metrics table
        this.renderPerformanceEvaluationTable()
        
        // Add evaluation insights
        this.addEvaluationInsights()
        
        // Add overall assessment
        this.addOverallAssessment()
      }

      renderPerformanceEvaluationTable() {
        if (!this.currentMetrics) return

        const tableDiv = document.createElement("div")
        tableDiv.classList.add("chat-message", "bot-reply")

        let tableHTML = `
          <i class="fas fa-table me-2"></i>
          <div class="performance-evaluation">
            <div class="evaluation-header">ðŸ“ˆ Performance Metrics Analysis</div>
            <table class="evaluation-metrics-table">
              <thead>
                <tr>
                  <th>Metric</th>
                  <th>Value</th>
                  <th>Evaluation</th>
                </tr>
              </thead>
              <tbody>
        `

        // Define evaluation criteria with more comprehensive scoring
        const evaluationCriteria = {
          "Sharpe Ratio": (value) => {
            const num = parseFloat(value)
            if (num > 2) return { rating: "Excellent", color: "rec-buy" }
            if (num > 1.5) return { rating: "Very Good", color: "rec-buy" }
            if (num > 1) return { rating: "Good", color: "rec-hold" }
            if (num > 0.5) return { rating: "Average", color: "rec-hold" }
            return { rating: "Poor", color: "rec-sell" }
          },
          "Sortino Ratio": (value) => {
            const num = parseFloat(value)
            if (num > 2) return { rating: "Excellent", color: "rec-buy" }
            if (num > 1.5) return { rating: "Very Good", color: "rec-buy" }
            if (num > 1) return { rating: "Good", color: "rec-hold" }
            if (num > 0.5) return { rating: "Average", color: "rec-hold" }
            return { rating: "Poor", color: "rec-sell" }
          },
          "Calmar Ratio": (value) => {
            const num = parseFloat(value)
            if (num > 1.5) return { rating: "Excellent", color: "rec-buy" }
            if (num > 1) return { rating: "Very Good", color: "rec-buy" }
            if (num > 0.5) return { rating: "Good", color: "rec-hold" }
            if (num > 0.2) return { rating: "Average", color: "rec-hold" }
            return { rating: "Poor", color: "rec-sell" }
          },
          "Win Rate (%)": (value) => {
            const num = parseFloat(value.replace('%', ''))
            if (num > 70) return { rating: "Excellent", color: "rec-buy" }
            if (num > 60) return { rating: "Good", color: "rec-hold" }
            if (num > 50) return { rating: "Average", color: "rec-hold" }
            return { rating: "Poor", color: "rec-sell" }
          },
          "CAGR": (value) => {
            const num = parseFloat(value)
            if (num > 20) return { rating: "Excellent", color: "rec-buy" }
            if (num > 15) return { rating: "Very Good", color: "rec-buy" }
            if (num > 10) return { rating: "Good", color: "rec-hold" }
            if (num > 5) return { rating: "Average", color: "rec-hold" }
            return { rating: "Poor", color: "rec-sell" }
          },
          "Max Drawdown": (value) => {
            const num = Math.abs(parseFloat(value))
            if (num < 5) return { rating: "Excellent", color: "rec-buy" }
            if (num < 10) return { rating: "Good", color: "rec-hold" }
            if (num < 15) return { rating: "Average", color: "rec-hold" }
            if (num < 25) return { rating: "High Risk", color: "rec-sell" }
            return { rating: "Very High Risk", color: "rec-sell" }
          }
        }

        Object.entries(this.currentMetrics).forEach(([metric, value]) => {
          let evaluation = { rating: "N/A", color: "rec-hold" }
          
          if (evaluationCriteria[metric]) {
            evaluation = evaluationCriteria[metric](value)
          }

          tableHTML += `
            <tr>
              <td class="strategy-name">${metric}</td>
              <td class="metric-value">${value}</td>
              <td class="recommendation ${evaluation.color}">${evaluation.rating}</td>
            </tr>
          `
        })

        tableHTML += `
              </tbody>
            </table>
          </div>
        `

        tableDiv.innerHTML = tableHTML
        this.chatMessages.appendChild(tableDiv)
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight
      }

      addEvaluationInsights() {
        const insightsDiv = document.createElement("div")
        insightsDiv.classList.add("chat-message", "bot-reply")

        // Generate insights based on metrics
        let insights = []
        
        if (this.currentMetrics["Sharpe Ratio"]) {
          const sharpe = parseFloat(this.currentMetrics["Sharpe Ratio"])
          if (sharpe > 1.5) {
            insights.push("âœ… Strong risk-adjusted returns indicate efficient strategy performance")
          } else if (sharpe < 0.5) {
            insights.push("âš ï¸ Low Sharpe ratio suggests room for improvement in risk management")
          }
        }

        if (this.currentMetrics["Win Rate (%)"]) {
          const winRate = parseFloat(this.currentMetrics["Win Rate (%)"].replace('%', ''))
          if (winRate > 65) {
            insights.push("âœ… High win rate demonstrates consistent strategy effectiveness")
          } else if (winRate < 45) {
            insights.push("âš ï¸ Consider refining entry/exit signals to improve win rate")
          }
        }

        if (this.currentMetrics["Max Drawdown"]) {
          const drawdown = Math.abs(parseFloat(this.currentMetrics["Max Drawdown"]))
          if (drawdown > 15) {
            insights.push("ðŸ”´ High drawdown suggests implementing stronger risk controls")
          } else if (drawdown < 8) {
            insights.push("âœ… Low drawdown indicates good risk management")
          }
        }

        if (this.currentMetrics["CAGR"]) {
          const cagr = parseFloat(this.currentMetrics["CAGR"])
          if (cagr > 15) {
            insights.push("âœ… Excellent compound annual growth rate")
          } else if (cagr < 5) {
            insights.push("âš ï¸ CAGR below market average - consider strategy optimization")
          }
        }

        if (insights.length === 0) {
          insights = [
            "ðŸ“Š Strategy shows balanced performance across key metrics",
            "â° Consider monitoring performance over longer time periods",
            "ðŸ”„ Regular strategy review and optimization recommended"
          ]
        }

        const insightsHTML = `
          <i class="fas fa-lightbulb me-2"></i>
          <div class="recommendations">
            <div class="rec-header">ðŸ’¡ Key Performance Insights</div>
            <ul class="rec-list">
              ${insights.map(insight => `<li><i class="fas fa-arrow-right me-2"></i>${insight}</li>`).join('')}
            </ul>
          </div>
        `

        insightsDiv.innerHTML = insightsHTML
        this.chatMessages.appendChild(insightsDiv)
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight
      }

      addOverallAssessment() {
        const assessmentDiv = document.createElement("div")
        assessmentDiv.classList.add("chat-message", "bot-reply")

        // Calculate overall score based on key metrics
        let score = 0
        let totalMetrics = 0

        if (this.currentMetrics["Sharpe Ratio"]) {
          const sharpe = parseFloat(this.currentMetrics["Sharpe Ratio"])
          if (sharpe > 1.5) score += 4
          else if (sharpe > 1) score += 3
          else if (sharpe > 0.5) score += 2
          else score += 1
          totalMetrics++
        }

        if (this.currentMetrics["Win Rate (%)"]) {
          const winRate = parseFloat(this.currentMetrics["Win Rate (%)"].replace('%', ''))
          if (winRate > 65) score += 4
          else if (winRate > 55) score += 3
          else if (winRate > 45) score += 2
          else score += 1
          totalMetrics++
        }

        if (this.currentMetrics["Max Drawdown"]) {
          const drawdown = Math.abs(parseFloat(this.currentMetrics["Max Drawdown"]))
          if (drawdown < 8) score += 4
          else if (drawdown < 15) score += 3
          else if (drawdown < 25) score += 2
          else score += 1
          totalMetrics++
        }

        const avgScore = totalMetrics > 0 ? score / totalMetrics : 2.5
        let assessment, scoreClass

        if (avgScore >= 3.5) {
          assessment = "Excellent Performance"
          scoreClass = "score-excellent"
        } else if (avgScore >= 2.5) {
          assessment = "Good Performance"
          scoreClass = "score-good"
        } else if (avgScore >= 1.5) {
          assessment = "Average Performance"
          scoreClass = "score-average"
        } else {
          assessment = "Needs Improvement"
          scoreClass = "score-poor"
        }

        const assessmentHTML = `
          <i class="fas fa-award me-2"></i>
          <div class="overall-assessment">
            <div class="assessment-header">ðŸŽ¯ Overall Strategy Assessment</div>
            <div class="assessment-score ${scoreClass}">${assessment}</div>
            <div class="assessment-content">
              Score: ${avgScore.toFixed(1)}/4.0 based on key performance indicators
            </div>
          </div>
        `

        assessmentDiv.innerHTML = assessmentHTML
        this.chatMessages.appendChild(assessmentDiv)
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight
      }

      showRecommendations(recommendations) {
        const recDiv = document.createElement("div")
        recDiv.classList.add("chat-message", "bot-reply")

        let recHTML = `
          <i class="fas fa-star me-2"></i>
          <div class="recommendations">
            <div class="rec-header">ðŸŒŸ Key Recommendations</div>
            <ul class="rec-list">
        `

        recommendations.forEach((rec) => {
          recHTML += `<li><i class="fas fa-arrow-right me-2"></i>${rec}</li>`
        })

        recHTML += `
            </ul>
          </div>
        `

        recDiv.innerHTML = recHTML
        this.chatMessages.appendChild(recDiv)
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight
      }
    }

    // Initialize enhanced chat when page loads
    let tradingChat
    document.addEventListener("DOMContentLoaded", () => {
      // Wait a bit to ensure all other scripts are loaded
      setTimeout(() => {
        tradingChat = new EnhancedTradingChat()
        window.tradingChat = tradingChat; // Make it globally accessible
      }, 500)
    })

    // Strategy descriptions
    function updateStrategyDescription() {
      const descBox = document.getElementById('strategy-description');
      const strategy = document.getElementById('strategy').value;
      let description = '';
      
      switch(strategy) {
        case 'vwap':
          description = "VWAP (Volume Weighted Average Price) Confirmation strategy uses volume-weighted price levels to identify optimal entry and exit points based on institutional trading patterns.";
          break;
          
        case '3_pos':
          description = "3-Candle Positive Closes strategy identifies bullish momentum by looking for three consecutive positive closing candles, indicating strong upward price movement.";
          break;

        case 'hma_ema':
          description = "RSI-MA Crossover strategy combines Relative Strength Index with Moving Average crossovers to identify overbought/oversold conditions and trend reversals.";
          break;

        case 'macd_ema':
          description = "MACD Crossover strategy uses Moving Average Convergence Divergence signals to identify trend changes and momentum shifts in price action.";
          break;

        case 'adx_dmi':
          description = "ADX DMI Crossover strategy utilizes Average Directional Index and Directional Movement Indicators to measure trend strength and direction changes.";
          break;

        case 'rsi_macd':
          description = "RSI + MACD Crossover strategy combines momentum and trend indicatorsâ€”buy signals are triggered when MACD crosses above its signal line and RSI confirms upward momentum, enhancing signal reliability.";
          break;

        case 'triple_ema':
          description = "Triple EMA strategy uses three Exponential Moving Averages (short, medium, and long) to capture trend direction and generate buy/sell signals based on crossover patterns and momentum alignment.";
          break;

        case 'elder_triple':
          description = "Elder Triple Screen strategy combines multiple indicators across different timeframes: a long-term trend filter (e.g., MACD), a short-term momentum oscillator (e.g., RSI), and breakout confirmation to identify high-probability trades aligned with the market trend.";
          break;

        case 'bb_adx':
          description = "Bollinger Bands strategy uses a moving average with upper and lower bands based on standard deviation to identify volatility and potential reversal zones, helping to spot overbought or oversold conditions.";
          break;

        case 'rsi_bb':
           description = "RSI + Bollinger Band Squeeze strategy detects low-volatility periods using Bollinger Band contraction and uses RSI to confirm breakout direction, aiming to capture explosive moves from consolidation zones.";
          break;
          
        default:
          description = '';
      }
      
      if(description) {
        descBox.style.display = 'block';
        descBox.innerHTML = `<i class="fas fa-info-circle me-2"></i>${description}`;
      } else {
        descBox.style.display = 'none';
        descBox.innerHTML = '';
      }
    }

    // Validation
    const investmentCapitalInput = document.getElementById('invest_cap');
    const thresholdBalanceInput = document.getElementById('min_trade_bal');
    const thresholdWarning = document.getElementById('thresholdWarning');
    const submitButton = document.getElementById('submitButton');

    function validateThreshold() {
      const investmentCapital = parseFloat(investmentCapitalInput.value);
      const thresholdBalance = parseFloat(thresholdBalanceInput.value);

      if (!isNaN(investmentCapital) && !isNaN(thresholdBalance)) {
        if (thresholdBalance >= investmentCapital) {
          thresholdWarning.style.display = 'block';
          submitButton.disabled = true;
        } else {
          thresholdWarning.style.display = 'none';
          submitButton.disabled = false;
        }
      } else {
        thresholdWarning.style.display = 'none';
        submitButton.disabled = false;
      }
    }
    

    investmentCapitalInput.addEventListener('input', validateThreshold);
    thresholdBalanceInput.addEventListener('input', validateThreshold);

    console.log('ðŸš€ GlobalTradeHub Dashboard Loaded - Enhanced Features Applied');
  </script>
</body>
</html>